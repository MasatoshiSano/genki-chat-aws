<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS Chat</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- NEXUS Chat Header -->
    <div id="headerContainer">
        <div class="header">
            <div class="header-left">
                <h1>ğŸ’« NEXUS Chat</h1>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="content">
            <div class="login-container">
                <div class="logo">ğŸ’«</div>
                <h2>NEXUS Chat</h2>
                <p class="subtitle">ã‚ãªãŸã®æ¯æ—¥ã‚’æ˜ã‚‹ãã™ã‚‹AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</p>
        
                <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
                <div class="login-form" id="loginForm">
                    <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required>
                    <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required>
                    <button onclick="login()" id="loginButton" class="login-btn">ãƒ­ã‚°ã‚¤ãƒ³</button>
                    <a href="#" class="signup-link" onclick="showSignup()">æ–°è¦ç™»éŒ²ã¯ã“ã¡ã‚‰</a>
                </div>
                
                <!-- æ–°è¦ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
                <div class="login-form form-toggle" id="signupForm">
                    <input type="email" id="signupEmail" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required>
                    <input type="password" id="signupPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ä»¥ä¸Šï¼‰" required>
                    <input type="password" id="confirmPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆå†å…¥åŠ›ï¼‰" required>
                    <button onclick="signup()" id="signupButton" class="login-btn">æ–°è¦ç™»éŒ²</button>
                    <a href="#" class="signup-link" onclick="showLogin()">ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹</a>
                </div>
                
                <!-- ç¢ºèªã‚³ãƒ¼ãƒ‰å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
                <div class="login-form form-toggle" id="confirmForm">
                    <p class="subtitle">ãƒ¡ãƒ¼ãƒ«ã«é€ä¿¡ã•ã‚ŒãŸç¢ºèªã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                    <input type="text" id="confirmationCode" placeholder="ç¢ºèªã‚³ãƒ¼ãƒ‰" required>
                    <button onclick="confirmSignup()" id="confirmButton" class="login-btn">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ–</button>
                    <a href="#" class="signup-link" onclick="showLogin()">ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹</a>
                </div>
                
                <div id="status" class="status"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="auth.js"></script>
    <script>
        // Cognitoè¨­å®š
        const COGNITO_CONFIG = {
            userPoolId: 'ap-northeast-1_7CLrXZQiB',
            clientId: '7af0tuk3i9r0lir5uhqduiep04',
            clientSecret: '1t87e432carkn9lg6i4tjhmj8brkf7mp1vj8phqhkuljpqtqtnia',
            region: 'ap-northeast-1'
        };
        
        // Cognitoèªè¨¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        const cognitoAuth = new CognitoAuth(COGNITO_CONFIG);
        let pendingEmail = '';

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
        document.addEventListener('DOMContentLoaded', function() {
            if (cognitoAuth.restoreSession()) {
                // æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã¯ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸ã«é·ç§»
                window.location.href = 'chat.html';
            }
        });

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }
        
        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }
        
        function showLogin() {
            document.getElementById('loginForm').style.display = 'flex';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('confirmForm').style.display = 'none';
            hideStatus();
        }
        
        function showSignup() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'flex';
            document.getElementById('confirmForm').style.display = 'none';
            hideStatus();
        }
        
        function showConfirm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('confirmForm').style.display = 'flex';
            hideStatus();
        }

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showStatus('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const button = document.getElementById('loginButton');
            button.disabled = true;
            button.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
            
            try {
                const result = await cognitoAuth.signIn(email, password);
                
                if (result.success) {
                    showStatus('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸ã«é·ç§»ä¸­...', 'success');
                    setTimeout(() => {
                        window.location.href = 'chat.html';
                    }, 1000);
                } else {
                    showStatus(result.error || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                showStatus('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
            }
        }
        
        async function signup() {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!email || !password || !confirmPassword) {
                showStatus('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showStatus('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“', 'error');
                return;
            }
            
            if (password.length < 8) {
                showStatus('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const button = document.getElementById('signupButton');
            button.disabled = true;
            button.textContent = 'ç™»éŒ²ä¸­...';
            
            try {
                const result = await cognitoAuth.signUp(email, password, {
                    email: email
                });
                
                if (result.success) {
                    pendingEmail = email;
                    showStatus('ç™»éŒ²æˆåŠŸï¼ãƒ¡ãƒ¼ãƒ«ã«ç¢ºèªã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¾ã—ãŸ', 'success');
                    setTimeout(() => {
                        showConfirm();
                    }, 2000);
                } else {
                    showStatus(result.error || 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                showStatus('ç™»éŒ²ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'æ–°è¦ç™»éŒ²';
            }
        }
        
        async function confirmSignup() {
            const code = document.getElementById('confirmationCode').value;
            
            if (!code) {
                showStatus('ç¢ºèªã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const button = document.getElementById('confirmButton');
            button.disabled = true;
            button.textContent = 'ç¢ºèªä¸­...';
            
            try {
                const result = await cognitoAuth.confirmSignUp(pendingEmail, code);
                
                if (result.success) {
                    showStatus('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æœ‰åŠ¹åŒ–ãŒå®Œäº†ã—ã¾ã—ãŸï¼ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'success');
                    setTimeout(() => {
                        showLogin();
                    }, 2000);
                } else {
                    showStatus(result.error || 'ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                showStatus('ç¢ºèªã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ–';
            }
        }
    </script>
</body>
</html>